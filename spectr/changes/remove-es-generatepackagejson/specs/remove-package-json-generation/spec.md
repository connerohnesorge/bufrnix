# Specification: Remove Package.json Generation Capability

**Capability ID**: `remove-package-json-generation`

**Related Change**: `remove-es-generatepackagejson`

**Status**: Draft

---

## ADDED Requirements

### Requirement: No Automatic Package.json Generation

The system SHALL NOT generate `package.json` files for any JavaScript code generation (Protobuf-ES, ts-proto, Connect). The `generatePackageJson` configuration option SHALL NOT be accepted in configurations for `js.es`, `js.tsProto`, or `js.connect` modules.

#### Scenario: ES Modules configuration without package.json generation

```nix
# Valid configuration - generatePackageJson option not available
languages.js.es = {
  enable = true;
  target = "ts";
  importExtension = ".js";
};
```

#### Scenario: Configuration with removed option fails validation

```nix
# This configuration MUST raise an error:
languages.js.es = {
  enable = true;
  generatePackageJson = true;  # ← Configuration error: unknown option
};
```

---

### Requirement: No Package Name Configuration

The system SHALL NOT accept `packageName` configuration options for any JavaScript sub-modules. All `packageName` options including `js.es.packageName`, `js.tsProto.packageName`, and `js.connect.packageName` SHALL NOT be present in the configuration schema.

#### Scenario: packageName option is not available

```nix
# This configuration MUST raise an error:
languages.js.es = {
  enable = true;
  packageName = "@example/proto"; # ← Configuration error: unknown option
};
```

---

### Requirement: User-Managed JavaScript Package.json

Users MUST create and maintain their own `package.json` files for JavaScript/TypeScript projects. Bufrnix SHALL generate only protobuf code files (`.js`, `.d.ts`, `.pb.js`) and MUST NOT generate `package.json` files in any output directory.

#### Scenario: User creates package.json for ES Modules

```nix
# Configuration (user-managed package.json)
languages.js.es = {
  enable = true;
  target = "ts";
  importExtension = ".js";
};

# User creates package.json separately
# examples/js-es-modules/package.json:
# {
#   "name": "@myorg/proto",
#   "version": "1.0.0",
#   "type": "module",
#   "dependencies": {
#     "@bufbuild/protobuf": "^1.10.0"
#   }
# }
```

#### Scenario: User manages dependencies for ts-proto

```nix
# Configuration
languages.js.tsProto = {
  enable = true;
  options = ["esModuleInterop=true"];
};

# User maintains package.json with ts-proto dependencies
# {
#   "dependencies": {
#     "@grpc/grpc-js": "^1.10.0",
#     "nice-grpc": "^2.1.7"
#   }
# }
```

---

### Requirement: Configuration Schema Simplification

The configuration schema for JavaScript language modules MUST remove all package management options. Only protobuf generation options SHALL remain in the schema.

#### Scenario: Simplified ES modules configuration

```nix
# After change - clean protobuf-focused configuration
languages.js.es = {
  enable = true;           # Protobuf generation
  target = "ts";           # Protobuf generation
  importExtension = ".js"; # Protobuf generation
  options = [];            # Protobuf generation
};

# Removed package management options:
# - generatePackageJson
# - packageName
```

#### Scenario: Configuration errors for removed options

```nix
# This configuration MUST raise an error:
languages.js.es = {
  enable = true;
  generatePackageJson = true;  # ← Configuration error
};

# Error message MUST clearly indicate the option is no longer supported
```

---

### Requirement: No Generated package.json Files

Bufrnix output directories MUST NEVER contain `package.json` files generated by Bufrnix. All package management is the responsibility of the user's project.

#### Scenario: Output inspection after ES modules generation

```bash
# After running: nix build
# Generated output SHALL contain only protobuf code files
ls result/gen/js/
# Expected output:
# example_pb.js           # ← Protobuf generated
# example_pb.d.ts        # ← Protobuf generated
# google_protobuf_pb.js  # ← Protobuf generated
# (no package.json)
```

#### Scenario: ts-proto generation output

```bash
# After ts-proto generation
ls result/gen/ts-proto/
# Expected output:
# example.ts           # ← ts-proto generated
# example.pb.ts        # ← ts-proto generated
# (no package.json)
```

---

### Requirement: Documentation of Migration Path

Documentation MUST guide users through the breaking change from auto-generated to user-managed `package.json`. Migration guide MUST include before/after examples and concrete steps for each use case.

#### Scenario: User migrating ES modules configuration

````markdown
# Migration Example

## Before (Old - No Longer Works)

```nix
languages.js.es = {
  enable = true;
  generatePackageJson = true;
  packageName = "@example/proto";
};
```
````

## After (New - Required)

```nix
languages.js.es = {
  enable = true;
};

# Create package.json in project:
# {
#   "name": "@example/proto",
#   "dependencies": {
#     "@bufbuild/protobuf": "^1.10.0"
#   }
# }
```

```

#### Scenario: Finding migration guidance
Migration guide must exist at `doc/src/content/docs/guides/migrating-from-generatepackagejson.mdx` with:
- Clear explanation of the change
- Before/after configuration examples
- Example `package.json` templates for ES modules and ts-proto
- Migration checklist
- Links from main documentation
```
